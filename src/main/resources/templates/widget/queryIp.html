<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#10b981">
    <title>IP 查询 - Sparkle (花火)</title>
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
          integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    
    <!-- Sparkle Design System -->
    <link rel="stylesheet" th:href="@{/css/sparkle.css}">
    
    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/d1dcdaf5b7.js" crossorigin="anonymous"></script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
            integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-7ymO4nGrkm372HoSbq1OY2DP4pEZnMiA+E0F3zPr+JQQtQ82gQ1HPY3QIVtztVua"
            crossorigin="anonymous"></script>
    
    <!-- Sparkle JS -->
    <script th:src="@{/js/sparkle.js}" defer></script>
</head>
<body class="spk-body">
<main class="spk-main">
    <div class="spk-container">
        <!-- Header Section -->
        <div class="spk-card spk-mb-3">
            <div class="spk-card__body">
                <h2 class="spk-mb-2 spk-flex spk-items-center spk-gap-2">
                    <span class="spk-color-dot" th:style="'background-color: ' + ${result.color}"></span>
                    <span th:text="${ip}">IP Address</span>
                </h2>
                <div th:if="${result.labels != null && !result.labels.isEmpty()}">
                    <span class="spk-badge spk-badge--secondary spk-mr-1 spk-mb-1" 
                          th:each="label : ${result.labels}" 
                          th:text="${label}"></span>
                </div>
            </div>
        </div>

        <!-- Bans Section -->
        <div class="spk-card spk-mb-3" th:if="${result.bans != null}">
            <div class="spk-card__header spk-card__header--danger">
                <h5 class="spk-card__title"><i class="fas fa-ban"></i> 封禁历史</h5>
                <p class="spk-card__subtitle" th:text="'最近 ' + ${timeConverter.formatDuration(result.bans.duration)}"></p>
            </div>
            <div class="spk-card__body">
                <div class="spk-grid spk-grid--3 spk-mb-3">
                    <div class="spk-stat-card">
                        <div class="spk-stat-card__label">总封禁次数</div>
                        <div class="spk-stat-card__value spk-stat-card__value--danger" th:text="${result.bans.total}">0</div>
                    </div>
                </div>
                
                <div th:if="${result.bans.records != null && !result.bans.records.isEmpty()}">
                    <div class="spk-table-wrapper spk-table-wrapper--scroll">
                        <table class="spk-table">
                            <thead>
                            <tr>
                                <th>时间</th>
                                <th>种子</th>
                                <th>端口</th>
                                <th>客户端</th>
                                <th>进度</th>
                                <th>流量 (↑/↓)</th>
                                <th>模块</th>
                                <th>规则</th>
                                <th>描述</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="ban : ${result.bans.records}">
                                <td class="spk-timestamp spk-text-nowrap" th:text="${#temporals.format(T(java.time.Instant).ofEpochMilli(ban.populateTime), 'yyyy-MM-dd HH:mm:ss')}"></td>
                                <td><span class="spk-text-truncate" style="max-width: 120px; display: inline-block;" th:text="${ban.torrent}" th:title="${ban.torrent}"></span></td>
                                <td th:text="${ban.peerPort}"></td>
                                <td th:text="${ban.peerClientName}"></td>
                                <td th:text="${ban.peerProgress != null ? #numbers.formatPercent(ban.peerProgress, 1, 2) : 'N/A'}"></td>
                                <td class="spk-text-nowrap"><small th:text="${T(com.ghostchu.btn.sparkle.util.MsgUtil).humanReadableByteCountBin(ban.toPeerTraffic) + ' / ' + T(com.ghostchu.btn.sparkle.util.MsgUtil).humanReadableByteCountBin(ban.fromPeerTraffic)}"></small></td>
                                <td><small th:text="${ban.moduleName != null && ban.moduleName.startsWith('com.ghostchu.peerbanhelper.module.impl.rule.') ? ban.moduleName.substring('com.ghostchu.peerbanhelper.module.impl.rule.'.length()) : ban.moduleName}"></small></td>
                                <td th:text="${ban.rule}"></td>
                                <td th:text="${ban.description}"></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="spk-empty" th:if="${result.bans.records == null || result.bans.records.isEmpty()}">
                    <i class="fas fa-inbox spk-empty__icon"></i>
                    <p class="spk-empty__text">未找到封禁记录</p>
                </div>
            </div>
        </div>

        <!-- Swarms Section -->
        <div class="spk-card spk-mb-3" th:if="${result.swarms != null}">
            <div class="spk-card__header spk-card__header--info">
                <h5 class="spk-card__title"><i class="fas fa-network-wired"></i> 种群活动</h5>
                <p class="spk-card__subtitle" th:text="'最近 ' + ${timeConverter.formatDuration(result.swarms.duration)}"></p>
            </div>
            <div class="spk-card__body">
                <div class="spk-grid spk-grid--2 spk-mb-3">
                    <div class="spk-stat-card">
                        <div class="spk-stat-card__label">总记录数</div>
                        <div class="spk-stat-card__value spk-stat-card__value--info" th:text="${result.swarms.total}">0</div>
                    </div>
                    <div class="spk-stat-card">
                        <div class="spk-stat-card__label">并发下载数</div>
                        <div class="spk-stat-card__value spk-stat-card__value--info" th:text="${result.swarms.concurrentDownloadTorrentsCount}">0</div>
                    </div>
                </div>
                
                <div th:if="${result.swarms.records != null && !result.swarms.records.isEmpty()}">
                    <div class="spk-table-wrapper spk-table-wrapper--scroll">
                        <table class="spk-table">
                            <thead>
                            <tr>
                                <th>种子</th>
                                <th>端口</th>
                                <th>Peer ID</th>
                                <th>客户端</th>
                                <th>Peer 进度</th>
                                <th>用户进度</th>
                                <th>流量 (↑/↓)</th>
                                <th>偏移量 (↑/↓)</th>
                                <th>标志</th>
                                <th>首次发现</th>
                                <th>最后发现</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="swarm : ${result.swarms.records}">
                                <td><span class="spk-text-truncate" style="max-width: 120px; display: inline-block;" th:text="${swarm.torrent}" th:title="${swarm.torrent}"></span></td>
                                <td th:text="${swarm.peerPort}"></td>
                                <td><small th:text="${swarm.peerId}"></small></td>
                                <td th:text="${swarm.peerClientName}"></td>
                                <td th:text="${swarm.peerProgress != null ? #numbers.formatPercent(swarm.peerProgress, 1, 2) : 'N/A'}"></td>
                                <td th:text="${#numbers.formatPercent(swarm.userProgress, 1, 2)}"></td>
                                <td class="spk-text-nowrap"><small th:text="${T(com.ghostchu.btn.sparkle.util.MsgUtil).humanReadableByteCountBin(swarm.toPeerTraffic) + ' / ' + T(com.ghostchu.btn.sparkle.util.MsgUtil).humanReadableByteCountBin(swarm.fromPeerTraffic)}"></small></td>
                                <td class="spk-text-nowrap"><small th:text="${T(com.ghostchu.btn.sparkle.util.MsgUtil).humanReadableByteCountBin(swarm.toPeerTrafficOffset) + ' / ' + T(com.ghostchu.btn.sparkle.util.MsgUtil).humanReadableByteCountBin(swarm.fromPeerTrafficOffset)}"></small></td>
                                <td th:text="${swarm.flags}"></td>
                                <td class="spk-timestamp spk-text-nowrap" th:text="${#temporals.format(T(java.time.Instant).ofEpochMilli(swarm.firstTimeSeen), 'yyyy-MM-dd HH:mm:ss')}"></td>
                                <td class="spk-timestamp spk-text-nowrap" th:text="${#temporals.format(T(java.time.Instant).ofEpochMilli(swarm.lastTimeSeen), 'yyyy-MM-dd HH:mm:ss')}"></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="spk-empty" th:if="${result.swarms.records == null || result.swarms.records.isEmpty()}">
                    <i class="fas fa-inbox spk-empty__icon"></i>
                    <p class="spk-empty__text">未找到种群记录</p>
                </div>
            </div>
        </div>

        <!-- Traffic Section -->
        <div class="spk-card spk-mb-3" th:if="${result.traffic != null}">
            <div class="spk-card__header spk-card__header--success">
                <h5 class="spk-card__title"><i class="fas fa-exchange-alt"></i> 流量统计</h5>
                <p class="spk-card__subtitle" th:text="'最近 ' + ${timeConverter.formatDuration(result.traffic.duration)}"></p>
            </div>
            <div class="spk-card__body">
                <div class="spk-grid spk-grid--3">
                    <div class="spk-stat-card">
                        <div class="spk-stat-card__label"><i class="fas fa-arrow-up"></i> 上传量</div>
                        <div class="spk-stat-card__value spk-stat-card__value--success" th:text="${T(com.ghostchu.btn.sparkle.util.MsgUtil).humanReadableByteCountBin(result.traffic.toPeerTraffic)}">0</div>
                    </div>
                    <div class="spk-stat-card">
                        <div class="spk-stat-card__label"><i class="fas fa-arrow-down"></i> 下载量</div>
                        <div class="spk-stat-card__value spk-stat-card__value--success" th:text="${T(com.ghostchu.btn.sparkle.util.MsgUtil).humanReadableByteCountBin(result.traffic.fromPeerTraffic)}">0</div>
                    </div>
                    <div class="spk-stat-card">
                        <div class="spk-stat-card__label"><i class="fas fa-percentage"></i> 分享率</div>
                        <div class="spk-stat-card__value spk-stat-card__value--success" th:text="${#numbers.formatDecimal(result.traffic.shareRatio, 1, 2)}">0.00</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Torrents Section -->
        <div class="spk-card spk-mb-3" th:if="${result.torrents != null}">
            <div class="spk-card__header spk-card__header--primary">
                <h5 class="spk-card__title"><i class="fas fa-download"></i> 种子统计</h5>
                <p class="spk-card__subtitle" th:text="'最近 ' + ${timeConverter.formatDuration(result.torrents.duration)}"></p>
            </div>
            <div class="spk-card__body">
                <div class="spk-grid spk-grid--3">
                    <div class="spk-stat-card">
                        <div class="spk-stat-card__label">唯一种子数</div>
                        <div class="spk-stat-card__value spk-stat-card__value--primary" th:text="${result.torrents.count}">0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="spk-text-center spk-text-muted spk-mt-4 spk-mb-3">
            <small>Powered by BTN-3.0 · Made with <i class="fas fa-heart spk-text-danger"></i></small>
        </div>
    </div>
</main>
</body>
</html>
