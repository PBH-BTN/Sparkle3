<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{components/common::header}"></head>
<body class="spk-body">
<nav th:replace="~{components/common::navbar}"></nav>

<header class="spk-page-header">
    <div class="spk-container spk-page-header__inner">
        <h1 class="spk-page-header__title">
            <i class="fas fa-cog"></i> 用户应用管理
        </h1>
        <a class="spk-btn spk-btn--light spk-btn--lg" th:href="@{/userapp/create}">
            <i class="fas fa-plus"></i> 创建新应用
        </a>
    </div>
</header>

<main class="spk-main" style="padding-top: 0;">
    <div class="spk-container">
        <!-- Table Card -->
        <div class="spk-table-wrapper" th:if="${userapps != null && !userapps.isEmpty()}">
            <table class="spk-table">
                <thead>
                <tr>
<!--                    <th>ID</th>-->
                    <th>AppId</th>
                    <th>备注</th>
<!--                    <th>创建时间</th>-->
                    <th>最近访问</th>
                    <th>状态</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="app : ${userapps}">
<!--                    <td th:text="${app.getId()}">1</td>-->
                    <td><code class="spk-code" th:text="${app.getAppId()}">000000000000000</code></td>
                    <td th:text="${app.getComment()}">测试</td>
<!--                    <td class="spk-timestamp" th:text="${app.getCreatedAt() != null ? #temporals.format(app.getCreatedAt(), 'yyyy-MM-dd HH:mm:ss') : 'N/A'}">-->
<!--                        2025-01-01 00:00:00-->
<!--                    </td>-->
                    <td class="spk-timestamp">N/A</td>
                    <td>
                        <span class="spk-badge spk-badge--success" th:if="${app.getBannedAt() == null}">
                            <i class="fas fa-check-circle"></i> 正常
                        </span>
                        <span class="spk-badge spk-badge--danger" th:if="${app.getBannedAt() != null}"
                              data-toggle="tooltip"
                              th:title="'已暂停：' + ${app.getBannedReason()} + ' 暂停状态下此 UserApp 无法继续提交数据，且在下次数据更新时，已提交的数据将被排除在外。'">
                            <i class="fas fa-ban"></i> 已暂停
                        </span>
                    </td>
                    <td class="spk-text-nowrap">
                        <form method="post" th:action="@{/userapp/{appId}/resetAppSecret(appId=${app.getAppId()})}" style="display:inline;">
                            <button type="submit" class="spk-action-link" 
                                    onclick="return confirm('确定要重置此应用的密钥吗？重置后旧密钥将立即失效！')">
                                <i class="fas fa-key"></i> 重置密钥
                            </button>
                        </form>
                        <form method="post" th:action="@{/userapp/{appId}/delete(appId=${app.getAppId()})}" style="display:inline;">
                            <button type="submit" class="spk-action-link spk-action-link--danger" 
                                    onclick="return confirm('确定要删除此应用吗？此操作无法撤销！')">
                                <i class="fas fa-trash"></i> 删除
                            </button>
                        </form>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Empty State -->
        <div class="spk-card" th:if="${userapps == null || userapps.isEmpty()}">
            <div class="spk-card__body">
                <div class="spk-empty">
                    <i class="fas fa-inbox spk-empty__icon"></i>
                    <h4 class="spk-empty__title">还没有创建任何应用</h4>
                    <p class="spk-empty__text">点击上方的"创建新应用"按钮来创建您的第一个用户应用</p>
                </div>
            </div>
        </div>
    </div>
</main>

<div th:replace="~{components/common::footer}"></div>
</body>
</html>