<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{components/common::header}"></head>
<body class="spk-body">
<nav th:replace="~{components/common::navbar}"></nav>

<header class="spk-page-header">
    <div class="spk-container spk-page-header__inner">
        <h1 class="spk-page-header__title">
            <i class="fas fa-satellite-dish"></i> 公共 Tracker 服务
        </h1>
    </div>
</header>

<main class="spk-main">
    <div class="spk-container">

        <!-- Tracker URL Card -->
        <section class="spk-mt-4">
            <div class="spk-card">
                <div class="spk-card__header">
                    <h3 class="spk-card__title"><i class="fas fa-link"></i> Tracker 地址</h3>
                </div>
                <div class="spk-card__body">
                    <div class="spk-credential">
                        <div class="spk-credential__label">
                            <i class="fas fa-server"></i>
                            Announce URL
                        </div>
                        <div class="spk-credential__value" th:attr="data-url=${announceUrl}">
                            <span th:text="${announceUrl}">https://tracker.ghostchu-services.top/announce</span>
                            <button class="spk-credential__copy" onclick="copyTrackerUrl()" id="copyBtn">
                                <i class="fas fa-copy"></i> 复制
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Introduction Section -->
        <section class="spk-mt-4">
            <div class="spk-card">
                <div class="spk-card__header">
                    <h3 class="spk-card__title"><i class="fas fa-info-circle"></i> 介绍</h3>
                </div>
                <div class="spk-card__body">
                    <p class="spk-text-secondary">
                        PBH-BTN/Trunker 是基于 Go 的高性能 Tracker 服务，除提供基本 Tracker 功能外，还能够与 Sparkle BTN 集成以提供辅助数据支持。
                    </p>
                    <p class="spk-text-secondary spk-mb-0">
                        <strong>Trunker 支持下列功能和特性：</strong>
                    </p>
                    <ul class="spk-text-secondary">
                        <li>IPv4 和 IPv6 双栈网络</li>
                        <li>完全开放，无需注册或认证</li>
                        <li>支持 BEP-0003, BEP-0007, BEP-0023, BEP-0024, BEP-0031, BEP-0048, BEP-0015 标准规范</li>
                        <li>支持 LibTorrent 扩展协议</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Placeholder Section -->
        <section class="spk-mt-4">
            <div class="spk-card">
                <div class="spk-card__body spk-text-center">
                    <div class="spk-empty">
                        <i class="fas fa-box-open spk-empty__icon"></i>
                        <p class="spk-empty__text">更多功能正在开发中，敬请期待...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Network Diagram Section -->
        <section class="spk-mt-4" th:if="${trackerDashboardUrl != null}">
            <div class="spk-card">
                <div class="spk-card__header">
                    <h3 class="spk-card__title"><i class="fas fa-network-wired"></i> 统计数据</h3>
                </div>
                <div class="spk-card__body">
                    <div class="spk-tracker-diagram">
                        <img th:src="${trackerDashboardUrl}"
                             alt="Tracker Dashboard"
                             class="spk-tracker-diagram__image">
                    </div>
                </div>
            </div>
        </section>
    </div>
</main>

<div th:replace="~{components/common::footer}"></div>

<script>
    function copyTrackerUrl() {
        const valueElement = document.querySelector('.spk-credential__value[data-url]');
        const url = valueElement ? valueElement.getAttribute('data-url') : '';
        const btn = document.getElementById('copyBtn');

        // 使用 Clipboard API 复制
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(url).then(() => {
                btn.innerHTML = '<i class="fas fa-check"></i> 已复制';
                btn.classList.add('spk-credential__copy--copied');

                setTimeout(() => {
                    btn.innerHTML = '<i class="fas fa-copy"></i> 复制';
                    btn.classList.remove('spk-credential__copy--copied');
                }, 2000);
            }).catch(() => {
                fallbackCopy(url, btn);
            });
        } else {
            fallbackCopy(url, btn);
        }
    }

    function fallbackCopy(text, btn) {
        // 降级方案：创建临时文本框
        const textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.style.position = 'fixed';
        textarea.style.opacity = '0';
        document.body.appendChild(textarea);
        textarea.select();

        try {
            document.execCommand('copy');
            btn.innerHTML = '<i class="fas fa-check"></i> 已复制';
            btn.classList.add('spk-credential__copy--copied');

            setTimeout(() => {
                btn.innerHTML = '<i class="fas fa-copy"></i> 复制';
                btn.classList.remove('spk-credential__copy--copied');
            }, 2000);
        } catch (err) {
            alert('复制失败，请手动复制');
        }

        document.body.removeChild(textarea);
    }
</script>
</body>
</html>
